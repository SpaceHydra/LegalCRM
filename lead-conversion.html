<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert Lead - Legal CRM</title>
    <link rel="stylesheet" href="css/common-styles.css">
    <style>
        .conversion-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .conversion-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .summary-label {
            opacity: 0.9;
        }

        .summary-value {
            font-weight: 700;
        }

        .section-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            color: #2c3e50;
        }

        .form-label.required::after {
            content: ' *';
            color: #e74c3c;
        }

        .form-input, .form-select, .form-textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            padding: 10px 0;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 10px 0;
        }

        .checkbox-option {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-top: 2px;
        }

        .checkbox-details {
            display: none;
            margin-top: 10px;
            padding-left: 28px;
        }

        .checkbox-details.active {
            display: block;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .info-box-title {
            font-weight: 700;
            color: #1976d2;
            margin-bottom: 5px;
        }

        .info-box-text {
            font-size: 13px;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <div class="logo-section">
            <div class="logo">LC</div>
            <div class="system-title">
                <h1>Legal CRM Portal</h1>
                <p>SNG & Partners - Business Development Platform</p>
            </div>
        </div>
        <div class="user-section">
            <div class="search-box">
                <span>üîç</span>
                <input type="text" placeholder="Search...">
            </div>
            <div class="notification-icon">
                <span style="font-size: 24px;">üîî</span>
                <div class="badge" id="notificationCount">0</div>
            </div>
            <div class="user-profile">
                <div class="user-avatar">AM</div>
                <div>
                    <div style="font-weight: 600; font-size: 14px;">Akash Mehta</div>
                    <div style="font-size: 11px; opacity: 0.8;">BD Manager</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="nav-section">
            <div class="nav-section-title">Core Modules (MVP)</div>
            <a href="dashboard.html" class="nav-item">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">Dashboard</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="lead-management.html" class="nav-item active">
                <div class="nav-icon">üéØ</div>
                <div class="nav-label">Lead Management</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="client-management.html" class="nav-item">
                <div class="nav-icon">üë•</div>
                <div class="nav-label">Client Management</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="project-management.html" class="nav-item">
                <div class="nav-icon">üìÅ</div>
                <div class="nav-label">Matter/Project Management</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="task-management.html" class="nav-item">
                <div class="nav-icon">‚úÖ</div>
                <div class="nav-label">Task Management</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="document-management.html" class="nav-item">
                <div class="nav-icon">üìÑ</div>
                <div class="nav-label">Document Management</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="user-management.html" class="nav-item">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">User & Role Management</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="reporting.html" class="nav-item">
                <div class="nav-icon">üìà</div>
                <div class="nav-label">Basic Reporting</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="billing.html" class="nav-item">
                <div class="nav-icon">üí∞</div>
                <div class="nav-label">Billing & Revenue</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
            <a href="calendar.html" class="nav-item">
                <div class="nav-icon">üìÜ</div>
                <div class="nav-label">Calendar Integration</div>
                <div class="phase-badge mvp">MVP</div>
            </a>
        </div>
        <div class="nav-section">
            <div class="nav-section-title">Phase 2</div>
            <a href="advocates-management.html" class="nav-item">
                <div class="nav-icon">üë®‚Äç‚öñÔ∏è</div>
                <div class="nav-label">Empaneled Advocates</div>
                <div class="phase-badge phase2">Phase 2</div>
            </a>
            <a href="audit-trail.html" class="nav-item">
                <div class="nav-icon">üîç</div>
                <div class="nav-label">Audit Trail</div>
                <div class="phase-badge phase2">Phase 2</div>
            </a>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
        <div class="conversion-container">
            <!-- Breadcrumb -->
            <div style="margin-bottom: 20px; color: #7f8c8d; font-size: 14px;">
                <a href="dashboard.html" style="color: #7f8c8d;">CRM</a> &gt;
                <a href="lead-management.html" style="color: #7f8c8d;">Leads</a> &gt;
                <a href="#" id="breadcrumbLeadLink" style="color: #7f8c8d;">Lead</a> &gt;
                <span style="color: #2c3e50; font-weight: 600;">Convert to Opportunity</span>
            </div>

            <h2 style="margin-bottom: 25px;">üîÑ Convert Lead to Opportunity</h2>

            <!-- Conversion Summary -->
            <div class="conversion-summary">
                <h3 style="margin: 0 0 15px 0;">Conversion Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="summary-label">Lead:</span>
                        <span class="summary-value" id="summaryLeadName">Rajesh Kumar</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Company:</span>
                        <span class="summary-value" id="summaryCompany">HDFC Bank Ltd</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Owner:</span>
                        <span class="summary-value" id="summaryOwner">Akash Mehta</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Status:</span>
                        <span class="summary-value" id="summaryStatus">Qualified</span>
                    </div>
                </div>
            </div>

            <!-- Account Creation -->
            <div class="section-card">
                <h3 class="section-title">Account Creation</h3>

                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="accountOption" value="new" checked onchange="toggleAccountSection()">
                        <span>Create New Account</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="accountOption" value="existing" onchange="toggleAccountSection()">
                        <span>Link to Existing Account</span>
                    </label>
                </div>

                <div id="newAccountSection" style="margin-top: 20px;">
                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label class="form-label required">Account Name</label>
                            <input type="text" class="form-input" id="accountName" placeholder="HDFC Bank Ltd">
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Industry</label>
                            <select class="form-select" id="industry">
                                <option value="">Select Industry</option>
                                <option value="Banking">Banking</option>
                                <option value="Legal">Legal</option>
                                <option value="Real Estate">Real Estate</option>
                                <option value="Consulting">Consulting</option>
                                <option value="Manufacturing">Manufacturing</option>
                                <option value="Technology">Technology</option>
                                <option value="Healthcare">Healthcare</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">City</label>
                            <select class="form-select" id="city">
                                <option value="">Select City</option>
                                <option value="Mumbai">Mumbai</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Bengaluru">Bengaluru</option>
                                <option value="Pune">Pune</option>
                                <option value="Hyderabad">Hyderabad</option>
                                <option value="Chennai">Chennai</option>
                                <option value="Kolkata">Kolkata</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">State</label>
                            <select class="form-select" id="state">
                                <option value="">Select State</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="West Bengal">West Bengal</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label">GST No.</label>
                            <input type="text" class="form-input" id="gstNo" placeholder="27AAACH2702H1Z4">
                        </div>
                    </div>
                </div>

                <div id="existingAccountSection" style="margin-top: 20px; display: none;">
                    <div class="form-group">
                        <label class="form-label required">Search Account</label>
                        <select class="form-select" id="existingAccount">
                            <option value="">Search and select account...</option>
                            <option value="ACC-2025-001">HDFC Bank Ltd</option>
                            <option value="ACC-2025-002">SBI</option>
                            <option value="ACC-2025-003">ICICI Bank</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Primary Contact -->
            <div class="section-card">
                <h3 class="section-title">Primary Contact</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label required">Contact Name</label>
                        <input type="text" class="form-input" id="contactName" placeholder="Rajesh Kumar">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Email</label>
                        <input type="email" class="form-input" id="contactEmail" placeholder="rajesh.kumar@hdfcbank.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Phone</label>
                        <input type="tel" class="form-input" id="contactPhone" placeholder="98765 43210">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <select class="form-select" id="contactRole">
                            <option value="">Select Role</option>
                            <option value="Decision Maker">Decision Maker</option>
                            <option value="Influencer">Influencer</option>
                            <option value="User">User</option>
                            <option value="Technical Evaluator">Technical Evaluator</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Opportunity (Deal) -->
            <div class="section-card">
                <h3 class="section-title">Opportunity (Deal)</h3>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label class="form-label required">Deal Name</label>
                        <input type="text" class="form-input" id="dealName" placeholder="HDFC - Litigation & BPR CRM">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Expected Revenue (‚Çπ)</label>
                        <input type="number" class="form-input" id="expectedRevenue" placeholder="3500000">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Closing Date</label>
                        <input type="date" class="form-input" id="closingDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Stage</label>
                        <select class="form-select" id="stage">
                            <option value="Discovery">Discovery</option>
                            <option value="Proposal Preparation">Proposal Preparation</option>
                            <option value="Proposal Sent">Proposal Sent</option>
                            <option value="Negotiation">Negotiation</option>
                            <option value="Commercial Approval">Commercial Approval</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Deal Type</label>
                        <select class="form-select" id="dealType">
                            <option value="New Business">New Business</option>
                            <option value="Upsell">Upsell</option>
                            <option value="Renewal">Renewal</option>
                            <option value="Cross-sell">Cross-sell</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Post-Conversion Options -->
            <div class="section-card">
                <h3 class="section-title">Post-Conversion Options</h3>

                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" id="createTask" checked onchange="toggleTaskDetails()">
                        <span>Create follow-up task for owner</span>
                    </label>
                    <div id="taskDetails" class="checkbox-details active">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Due Date</label>
                                <select class="form-select" id="taskDueDate">
                                    <option value="3">+3 days</option>
                                    <option value="5">+5 days</option>
                                    <option value="7">+7 days</option>
                                    <option value="14">+14 days</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Subject</label>
                                <input type="text" class="form-input" id="taskSubject" value="Demo + Requirement Freezing">
                            </div>
                        </div>
                    </div>

                    <label class="checkbox-option">
                        <input type="checkbox" id="keepLead" checked>
                        <span>Keep Lead record but mark as "Converted"</span>
                    </label>

                    <label class="checkbox-option">
                        <input type="checkbox" id="deleteLead">
                        <span>Delete Lead after conversion</span>
                    </label>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="cancelConversion()">Cancel</button>
                <button class="btn btn-success" onclick="convertLead()">‚úÖ Convert</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/data.js"></script>
    <script src="js/common.js"></script>
    <script>
        let currentLeadId = null;

        document.addEventListener('DOMContentLoaded', function() {
            // Get lead ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            currentLeadId = urlParams.get('id');

            if (currentLeadId) {
                loadLeadData(currentLeadId);
            } else {
                alert('No lead ID provided');
                window.location.href = 'lead-management.html';
            }

            // Set default closing date to +30 days
            const today = new Date();
            today.setDate(today.getDate() + 30);
            document.getElementById('closingDate').value = today.toISOString().split('T')[0];
        });

        function loadLeadData(leadId) {
            const lead = legalCRM.getById('leads', leadId);
            if (!lead) {
                alert('Lead not found');
                window.location.href = 'lead-management.html';
                return;
            }

            // Populate summary
            document.getElementById('summaryLeadName').textContent = lead.name;
            document.getElementById('summaryCompany').textContent = lead.company;
            document.getElementById('summaryOwner').textContent = lead.assignedTo || 'Unassigned';
            document.getElementById('summaryStatus').textContent = lead.status;

            // Pre-fill forms
            document.getElementById('accountName').value = lead.company;
            document.getElementById('contactName').value = lead.name;
            document.getElementById('contactEmail').value = lead.email || '';
            document.getElementById('contactPhone').value = lead.phone;
            document.getElementById('dealName').value = lead.company + ' - CRM Implementation';

            // Set breadcrumb link
            document.getElementById('breadcrumbLeadLink').href = 'lead-details.html?id=' + leadId;
            document.getElementById('breadcrumbLeadLink').textContent = lead.name;
        }

        function toggleAccountSection() {
            const selectedOption = document.querySelector('input[name="accountOption"]:checked').value;
            document.getElementById('newAccountSection').style.display = selectedOption === 'new' ? 'block' : 'none';
            document.getElementById('existingAccountSection').style.display = selectedOption === 'existing' ? 'block' : 'none';
        }

        function toggleTaskDetails() {
            const checkbox = document.getElementById('createTask');
            const details = document.getElementById('taskDetails');
            details.classList.toggle('active', checkbox.checked);
        }

        function convertLead() {
            // Validate required fields
            const dealName = document.getElementById('dealName').value;
            const expectedRevenue = document.getElementById('expectedRevenue').value;
            const closingDate = document.getElementById('closingDate').value;

            if (!dealName || !expectedRevenue || !closingDate) {
                alert('Please fill all required fields (Deal Name, Expected Revenue, Closing Date)');
                return;
            }

            if (confirm('Convert this lead to an opportunity?')) {
                // Get lead data
                const lead = legalCRM.getById('leads', currentLeadId);

                // Create account (if new)
                const accountOption = document.querySelector('input[name="accountOption"]:checked').value;
                let accountId;

                if (accountOption === 'new') {
                    const accountName = document.getElementById('accountName').value;
                    const industry = document.getElementById('industry').value;
                    const city = document.getElementById('city').value;
                    const state = document.getElementById('state').value;

                    if (!accountName || !industry || !city || !state) {
                        alert('Please fill all required account fields');
                        return;
                    }

                    // Create new account (simplified - would normally use a proper clients entity)
                    accountId = 'ACC-' + Date.now();
                } else {
                    accountId = document.getElementById('existingAccount').value;
                    if (!accountId) {
                        alert('Please select an existing account');
                        return;
                    }
                }

                // Create opportunity
                const opportunity = {
                    id: legalCRM.generateId('opportunities', 'OPP'),
                    dealName: dealName,
                    accountId: accountId,
                    accountName: document.getElementById('accountName').value,
                    expectedRevenue: parseInt(expectedRevenue),
                    closingDate: closingDate,
                    stage: document.getElementById('stage').value,
                    dealType: document.getElementById('dealType').value,
                    owner: lead.assignedTo || 'Unassigned',
                    probability: 50,
                    sourceLeadId: currentLeadId,
                    sourceLeadName: lead.name,
                    region: lead.region || 'West',
                    industry: document.getElementById('industry').value || lead.industry,
                    status: 'Open',
                    createdDate: new Date().toISOString().split('T')[0],
                    createdBy: 'Akash Mehta'
                };

                // Create opportunity in data store
                legalCRM.create('opportunities', opportunity);

                // Create follow-up task if requested
                if (document.getElementById('createTask').checked) {
                    const dueDate = new Date();
                    dueDate.setDate(dueDate.getDate() + parseInt(document.getElementById('taskDueDate').value));

                    const task = {
                        id: legalCRM.generateId('tasks', 'TSK'),
                        title: document.getElementById('taskSubject').value,
                        description: 'Follow-up for converted opportunity: ' + dealName,
                        dueDate: dueDate.toISOString().split('T')[0],
                        assignedTo: lead.assignedTo || 'Unassigned',
                        priority: 'High',
                        status: 'Open',
                        relatedTo: opportunity.id,
                        relatedType: 'Opportunity',
                        createdDate: new Date().toISOString().split('T')[0]
                    };

                    legalCRM.create('tasks', task);
                }

                // Update lead status
                if (document.getElementById('keepLead').checked) {
                    legalCRM.update('leads', currentLeadId, {
                        status: 'Won',
                        convertedToOpportunity: opportunity.id,
                        convertedDate: new Date().toISOString().split('T')[0]
                    });
                } else if (document.getElementById('deleteLead').checked) {
                    legalCRM.delete('leads', currentLeadId);
                }

                // Log activity
                legalCRM.logActivity({
                    type: 'Conversion',
                    description: 'Lead converted to Opportunity',
                    relatedTo: opportunity.id,
                    user: 'Akash Mehta',
                    notes: 'Lead ' + lead.name + ' converted to opportunity ' + dealName
                });

                alert('Lead converted successfully!\nOpportunity ID: ' + opportunity.id);
                window.location.href = 'opportunity-details.html?id=' + opportunity.id;
            }
        }

        function cancelConversion() {
            if (confirm('Cancel conversion and return to lead details?')) {
                window.location.href = 'lead-details.html?id=' + currentLeadId;
            }
        }
    </script>
</body>
</html>
