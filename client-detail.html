<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Details - Legal CRM</title>
    <link rel="stylesheet" href="css/common-styles.css">
    <style>
        .detail-container { padding: 20px; max-width: 1400px; margin: 0 auto; }
        .detail-header { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .detail-header-top { display: flex; justify-content: space-between; align-items: start; margin-bottom: 20px; }
        .detail-title { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
        .detail-subtitle { font-size: 16px; opacity: 0.9; }
        .detail-actions { display: flex; gap: 10px; }
        .btn-action { padding: 10px 20px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        .btn-action:hover { background: rgba(255,255,255,0.3); }
        .detail-meta { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .meta-item { background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px; backdrop-filter: blur(10px); }
        .meta-label { font-size: 12px; opacity: 0.8; margin-bottom: 5px; }
        .meta-value { font-size: 20px; font-weight: 600; }
        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .detail-section { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .section-title { font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e5e7eb; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .info-item { display: flex; flex-direction: column; gap: 5px; }
        .info-label { font-size: 13px; color: #6b7280; font-weight: 500; }
        .info-value { font-size: 16px; color: #374151; font-weight: 500; }
        .category-badge { display: inline-block; padding: 6px 16px; border-radius: 16px; font-size: 14px; font-weight: 600; }
        .category-corporate { background: #dbeafe; color: #1e40af; }
        .category-individual { background: #fef3c7; color: #92400e; }
        .category-government { background: #e0e7ff; color: #3730a3; }
        .category-ngo { background: #d1fae5; color: #065f46; }
        .spoc-list { display: flex; flex-direction: column; gap: 15px; }
        .spoc-item { background: #f9fafb; padding: 15px; border-radius: 8px; border-left: 4px solid #6366f1; }
        .spoc-name { font-weight: 600; color: #374151; margin-bottom: 5px; }
        .spoc-details { color: #6b7280; font-size: 14px; }
        @media (max-width: 1024px) { .content-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="detail-container">
        <div class="detail-header">
            <div class="detail-header-top">
                <div>
                    <div class="detail-title" id="clientName">Loading...</div>
                    <div class="detail-subtitle" id="clientIndustry"></div>
                </div>
                <div class="detail-actions">
                    <button class="btn-action" onclick="createMatter()">üìÅ New Matter</button>
                    <button class="btn-action" onclick="editClient()">‚úèÔ∏è Edit</button>
                    <button class="btn-action" onclick="goBack()">‚Üê Back</button>
                </div>
            </div>
            <div class="detail-meta">
                <div class="meta-item"><div class="meta-label">Client ID</div><div class="meta-value" id="clientId">-</div></div>
                <div class="meta-item"><div class="meta-label">Category</div><div class="meta-value" id="clientCategory">-</div></div>
                <div class="meta-item"><div class="meta-label">Active Matters</div><div class="meta-value" id="activeMatters">0</div></div>
                <div class="meta-item"><div class="meta-label">Client Since</div><div class="meta-value" id="clientSince">-</div></div>
            </div>
        </div>

        <div class="content-grid">
            <div>
                <div class="detail-section">
                    <h2 class="section-title">Company Information</h2>
                    <div class="info-grid">
                        <div class="info-item"><div class="info-label">Company Name</div><div class="info-value" id="companyName">-</div></div>
                        <div class="info-item"><div class="info-label">Industry</div><div class="info-value" id="industry">-</div></div>
                        <div class="info-item"><div class="info-label">Website</div><div class="info-value"><a href="" id="website" target="_blank">-</a></div></div>
                        <div class="info-item"><div class="info-label">PAN</div><div class="info-value" id="pan">-</div></div>
                        <div class="info-item"><div class="info-label">GSTIN</div><div class="info-value" id="gstin">-</div></div>
                        <div class="info-item"><div class="info-label">Category</div><div class="info-value" id="category">-</div></div>
                    </div>
                </div>

                <div class="detail-section" style="margin-top: 20px;">
                    <h2 class="section-title">Address Details</h2>
                    <div class="info-grid">
                        <div class="info-item" style="grid-column: 1 / -1;"><div class="info-label">üìç Registered Address</div><div class="info-value" id="regAddress">-</div></div>
                        <div class="info-item" style="grid-column: 1 / -1;"><div class="info-label">üìç Communication Address</div><div class="info-value" id="commAddress">-</div></div>
                    </div>
                </div>

                <div class="detail-section" style="margin-top: 20px;">
                    <h2 class="section-title">Single Point of Contact (SPOC)</h2>
                    <div class="spoc-list" id="spocList"></div>
                </div>
            </div>

            <div>
                <div class="detail-section">
                    <h2 class="section-title">Active Matters</h2>
                    <div id="mattersList"></div>
                </div>

                <div class="detail-section" style="margin-top: 20px;">
                    <h2 class="section-title">Quick Actions</h2>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn-primary" style="width: 100%;" onclick="createMatter()">üìÅ Create Matter</button>
                        <button class="btn-primary" style="width: 100%;" onclick="viewInvoices()">üí∞ View Invoices</button>
                        <button class="btn-primary" style="width: 100%;" onclick="viewDocuments()">üìÑ View Documents</button>
                        <button class="btn-primary" style="width: 100%;" onclick="scheduleCall()">üìû Schedule Call</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/navigation.js"></script>
    <script src="js/data.js"></script>
    <script src="js/common.js"></script>
    <script>
        let currentClient = null;
        document.addEventListener('DOMContentLoaded', loadClientDetails);

        function loadClientDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const clientId = urlParams.get('id');
            if (!clientId) { alert('No client ID specified'); window.location.href = 'client-management.html'; return; }

            const clients = legalCRM.get('clients');
            currentClient = clients.find(c => c.id === clientId);
            if (!currentClient) { alert('Client not found'); window.location.href = 'client-management.html'; return; }

            document.getElementById('clientName').textContent = currentClient.name;
            document.getElementById('clientIndustry').textContent = currentClient.industry;
            document.getElementById('clientId').textContent = currentClient.id;
            document.getElementById('clientCategory').innerHTML = `<span class="category-badge category-${currentClient.category.toLowerCase()}">${currentClient.category}</span>`;
            document.getElementById('clientSince').textContent = new Date(currentClient.onboardingDate).getFullYear();
            document.getElementById('companyName').textContent = currentClient.name;
            document.getElementById('industry').textContent = currentClient.industry;
            document.getElementById('website').textContent = currentClient.website || 'Not provided';
            if (currentClient.website) document.getElementById('website').href = currentClient.website;
            document.getElementById('pan').textContent = currentClient.pan || 'Not provided';
            document.getElementById('gstin').textContent = currentClient.gstin || 'Not provided';
            document.getElementById('category').textContent = currentClient.category;
            document.getElementById('regAddress').textContent = currentClient.registeredAddress;
            document.getElementById('commAddress').textContent = currentClient.communicationAddress || 'Same as registered';

            // Load SPOC
            const spocList = document.getElementById('spocList');
            if (currentClient.spoc && currentClient.spoc.length > 0) {
                spocList.innerHTML = currentClient.spoc.map(s => `
                    <div class="spoc-item">
                        <div class="spoc-name">${s.name}</div>
                        <div class="spoc-details">
                            üìß ${s.email}<br>
                            üì± ${s.phone}<br>
                            ${s.designation}
                        </div>
                    </div>
                `).join('');
            } else {
                spocList.innerHTML = '<div style="color: #9ca3af; text-align: center; padding: 20px;">No SPOC contacts</div>';
            }

            // Load matters
            const matters = legalCRM.get('matters').filter(m => m.clientId === clientId);
            document.getElementById('activeMatters').textContent = matters.filter(m => m.status !== 'Closed').length;
            const mattersList = document.getElementById('mattersList');
            if (matters.length > 0) {
                mattersList.innerHTML = matters.slice(0, 5).map(m => `
                    <div style="padding: 10px; border-bottom: 1px solid #e5e7eb; cursor: pointer;" onclick="window.location.href='matter-detail.html?id=${m.id}'">
                        <div style="font-weight: 600;">${m.serialNumber}</div>
                        <div style="font-size: 13px; color: #6b7280;">${m.title}</div>
                    </div>
                `).join('');
            } else {
                mattersList.innerHTML = '<div style="color: #9ca3af; text-align: center; padding: 20px;">No matters</div>';
            }
        }

        function goBack() { window.location.href = 'client-management.html'; }
        function editClient() { window.location.href = `client-management.html?edit=${currentClient.id}`; }
        function createMatter() { alert('Navigate to Matter creation with this client pre-selected'); }
        function viewInvoices() { alert('View invoices for this client'); }
        function viewDocuments() { alert('View documents for this client'); }
        function scheduleCall() { alert('Schedule a call with this client'); }
    </script>
</body>
</html>
